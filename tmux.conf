# ===========================================
# TMUX CONFIG
# ===========================================

# -------------------------------------------
# BETTER PREFIX KEY
# Default is Ctrl+b, but Ctrl+a is easier
# -------------------------------------------
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# -------------------------------------------
# GENERAL SETTINGS
# -------------------------------------------
set -g mouse on                    # Enable mouse (scroll, click, resize)
set -g base-index 1                # Windows start at 1, not 0
set -g pane-base-index 1           # Panes start at 1, not 0
set -g renumber-windows on         # Renumber windows when one is closed
set -g history-limit 10000         # More scrollback
set -g default-terminal "tmux-256color"  # Better colors
set -ga terminal-overrides ",*256col*:Tc" # True color support

# Faster escape time (important for vim)
set -sg escape-time 0

# -------------------------------------------
# VIM-LIKE PANE NAVIGATION
# Ctrl+a then h/j/k/l to move between panes
# -------------------------------------------
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# -------------------------------------------
# SEAMLESS NVIM <-> TMUX NAVIGATION
# Ctrl+h/j/k/l moves between nvim splits AND tmux panes
# Works with vim-tmux-navigator plugin
# -------------------------------------------
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"

# -------------------------------------------
# EASIER SPLITS (and open in current path)
# Ctrl+a then | for vertical split
# Ctrl+a then - for horizontal split
# -------------------------------------------
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# New window in current path
bind c new-window -c "#{pane_current_path}"

# -------------------------------------------
# RESIZE PANES
# Ctrl+a then H/J/K/L (capital) to resize
# -------------------------------------------
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# -------------------------------------------
# EASY RELOAD CONFIG
# Ctrl+a then r to reload this file
# -------------------------------------------
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# -------------------------------------------
# APPEARANCE (tokyonight theme)
# -------------------------------------------

# Status bar position and general style
set -g status-position bottom
set -g status-style bg=#1a1b26,fg=#a9b1d6
set -g status-left-length 40
set -g status-right-length 60

# Left: session name with icon
set -g status-left "#[fg=#7aa2f7,bold] #S #[fg=#565f89]│ "

# Right: directory, git branch (if available), time
set -g status-right "#[fg=#565f89]│ #[fg=#9ece6a]󰉋 #{b:pane_current_path} #[fg=#565f89]│ #[fg=#bb9af7]%H:%M "

# Window tabs
set -g window-status-format "#[fg=#565f89] #I:#W "
set -g window-status-current-format "#[fg=#1a1b26,bg=#7aa2f7,bold] #I:#W "
set -g window-status-separator ""

# Pane borders
set -g pane-border-style fg=#3b4261
set -g pane-active-border-style fg=#7aa2f7

# Message/command style
set -g message-style bg=#1a1b26,fg=#7aa2f7

# -------------------------------------------
# SESSION PERSISTENCE (optional but useful)
# Ctrl+a Ctrl+s = save session
# Ctrl+a Ctrl+r = restore session
# -------------------------------------------
# Note: For full persistence across reboots, you'd need tmux-resurrect plugin
# For now, just use 'tmux attach' - sessions persist while tmux server runs

# Quick session switching
bind s choose-tree -Zs  # Switch sessions with preview
